<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>OneClub</title>
    <style type="text/css" media="all">
      @media only screen and (prefers-color-scheme: light) {
        :root {
          --color-text-primary: rgba(0, 0, 0, 1);
          --color-text-secondary: rgba(0, 0, 0, 0.5);
          --color-background: rgba(255, 255, 255, 1);
          --color-on-background: rgba(0, 0, 0, 1);
          --color-devider: rgba(0, 0, 0, 0.1);
        }
      }
      @media only screen and (prefers-color-scheme: dark) {
        :root {
          --color-text-primary: rgba(255, 255, 255, 1);
          --color-text-secondary: rgba(190, 190, 190, 1);
          --color-background: rgba(42, 45, 54, 1);
          --color-on-background: rgba(255, 255, 255, 1);
          --color-devider: rgba(255, 255, 255, 0.1);
        }
      }
      body {
        margin: 0;
        padding: 0;
        font-family: Sans-Serif;
        background-color: var(--color-background);
      }
      .activity-main > main {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
      }
      .activity-main > main > .container {
        width: 100%;
        height: 100vh;
        padding-bottom: 65px;
        box-sizing: border-box;
      }
      .activity-main > main > .container > .fragment {
        display: none;
      }
      .activity-main > main > .container > .fragment.active {
        display: block;
      }
      .activity-main > footer {
        width: 100%;
        height: 65px;
        max-width: 600px;
        background-color: var(--color-background);
        border-top: 1px solid var(--color-devider);
        position: fixed;
        left: 50%;
        bottom: 0;
        transform: translate(-50%, 0);
        user-select: none;
      }
      .activity-main > footer nav {
        width: 100%;
        height: 100%;
        display: flex;
      }
      .activity-main > footer nav .nav-btn {
        flex: 1;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .activity-main > footer nav .nav-btn .wrapper {
        color: var(--color-text-secondary);
        fill: var(--color-text-secondary);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .activity-main > footer nav .nav-btn.active .wrapper {
        color: var(--color-text-primary);
        fill: var(--color-text-primary);
      }
      .activity-main > footer nav .nav-btn .icon-wrapper {
        width: 24px;
        height: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .activity-main > footer nav .icon-wrapper .icon {
        width: 100%;
        height: 100%;
      }
      .activity-main > footer nav .icon-wrapper .icon-solid {
        display: none;
      }
      .activity-main > footer nav .nav-btn.active .icon-regular {
        /*display: none;*/
      }
      .activity-main > footer nav .nav-btn.active .icon-solid {
        /*display: block;*/
      }
      .activity-main > footer nav .nav-btn .title-wrapper {
        color: var(--color-text-primary);
        font-size: 10px;
        margin-top: 3px;
        margin-bottom: 2px;
        /*display: none;*/
      }
      .activity-main > footer nav .nav-btn .active-bar {
        width: 25px;
        height: 2px;
        border-radius: 100px;
        background-color: var(--color-on-background);
        visibility: hidden;
        /*display: none;*/
      }
      .activity-main > footer nav .nav-btn.active .active-bar {
        visibility: visible;
      }
      .fragment-home {
        width: 100%;
        height: 100%;
        overflow: scroll;
        scroll-behavior: smooth;
      }
      .fragment-home > header {
        width: 100%;
        height: 100px;
        background-color: var(--color-background);
        border-bottom: 1px solid var(--color-devider);
        position: sticky;
        top: -50px;
        user-select: none;
        z-index: 100;
      }
      .fragment-home > header > div {
        width: 100%;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .fragment-home > header > div div {
        width: 35px;
        height: 35px;
        fill: var(--color-text-primary);
      }
      .fragment-home > header nav {
        width: 100%;
        height: 50px;
        display: flex;
      }
      .fragment-home > header nav .tab-btn {
        flex: 1;
        height: 100%;
        display: flex;
        justify-content: center;
      }
      .fragment-home > header nav .tab-btn span {
        height: 100%;
        display: flex;
        align-items: center;
        position: relative;
        color: var(--color-text-primary);
        font-size: 14px;
        font-weight: 420;
      }
      .fragment-home > header nav .tab-btn.active span {
        color: var(--color-text-primary);
      }
      .fragment-home > header nav .tab-btn.active span::after {
        content: "";
        width: 100%;
        height: 4px;
        border-radius: 100px;
        background-color: var(--color-on-background);
        position: absolute;
        bottom: 0;
      }
      .fragment-home > main {
        width: 100%;
      }
      .fragment-home > main > .container {
        width: 100%;
      }
      .fragment-home > main > .container > .fragment {
        display: none;
      }
      .fragment-home > main > .container > .fragment.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="activity-main">
      <main>
        <div class="container">
          <div class="fragment fragment-home">
            <header>
              <div class="">
                <div class="">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g><path d="M17.523 15.342a1 1 0 1 1-.001-1.999 1 1 0 0 1 .001 1.999m-11.046 0a1 1 0 1 1-.001-1.999 1 1 0 0 1 .001 1.999m11.404-6.02 1.997-3.459a.415.415 0 1 0-.72-.416L17.136 8.95C15.59 8.244 13.853 7.851 12 7.851s-3.59.393-5.137 1.098L4.841 5.447a.416.416 0 0 0-.72.415l1.997 3.46c-3.43 1.865-5.775 5.337-6.119 9.44h24c-.343-4.103-2.688-7.575-6.118-9.44"></path></g>
                  </svg>
                </div>
              </div>
              <nav>
                <div class="tab-btn">
                  <span>Collections</span>
                </div>
                <div class="tab-btn">
                  <span>Expanses</span>
                </div>
              </nav>
            </header>
            <main>
              <div class="container" style="background-color: #efefef; height: 150vh">
                <div class="fragment">Collections</div>
                <div class="fragment">
                  <a href="app/login/">Login</a>
                  <a href="https://unitedculturalclub.github.io/app/">Nested!</a>
                </div>
              </div>
            </main>
          </div>
          <div class="fragment">Search</div>
          <div class="fragment">Broadcast</div>
          <div class="fragment">Profile</div>
        </div>
      </main>
      <footer>
        <nav>
          <div class="nav-btn">
            <div class="wrapper">
              <div class="icon-wrapper">
                <div class="icon icon-regular">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g>
                      <path d="M13.819 4.666a2.815 2.815 0 0 0-3.638 0L4.795 9.12C4.305 9.526 4 10.167 4 10.866v6.945C4 19.078 4.952 20 6 20h2v-3.252c0-2.255 1.734-4.19 4-4.19s4 1.935 4 4.19V20h2c1.048 0 2-.922 2-2.19v-6.944c0-.699-.304-1.34-.795-1.746zm1.274-1.541 5.386 4.453c.97.803 1.521 2.019 1.521 3.288v6.945C22 20.066 20.266 22 18 22h-2a2 2 0 0 1-2-2v-3.252c0-1.268-.952-2.19-2-2.19s-2 .922-2 2.19V20a2 2 0 0 1-2 2H6c-2.266 0-4-1.934-4-4.19v-6.944c0-1.269.55-2.485 1.521-3.288l5.386-4.453a4.814 4.814 0 0 1 6.186 0z"></path>
                    </g>
                  </svg>
                </div>
                <div class="icon icon-solid">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g>
                      <path d="m20.479 7.578-5.386-4.453a4.814 4.814 0 0 0-6.186 0L3.521 7.578C2.551 8.381 2 9.597 2 10.866v6.945C2 20.066 3.734 22 6 22h2a2 2 0 0 0 2-2v-3.252c0-1.268.952-2.19 2-2.19s2 .922 2 2.19V20a2 2 0 0 0 2 2h2c2.266 0 4-1.934 4-4.19v-6.944c0-1.269-.55-2.485-1.521-3.288z" clip-rule="evenodd" opacity="1" data-original="#000000"></path>
                    </g>
                  </svg>
                </div>
              </div>
              <div class="title-wrapper">
                <span>Home</span>
              </div>
              <div class="active-bar"></div>
            </div>
          </div>
          <div class="nav-btn">
            <div class="wrapper">
              <div class="icon-wrapper">
                <div class="icon icon-regular">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M19 10.5A8.5 8.5 0 1 1 10.5 2a8.5 8.5 0 0 1 8.5 8.5Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                    <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="16.511" x2="22" y1="16.511" y2="22"></line>
                  </svg>
                </div>
                <div class="icon icon-solid">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M18.5 10.5a8 8 0 1 1-8-8 8 8 0 0 1 8 8Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></path>
                    <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" x1="16.511" x2="21.643" y1="16.511" y2="21.643"></line>
                  </svg>
                </div>
              </div>
              <div class="title-wrapper">
                <span>Search</span>
              </div>
              <div class="active-bar"></div>
            </div>
          </div>
          <div class="nav-btn">
            <div class="wrapper">
              <div class="icon-wrapper">
                <div class="icon icon-regular">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g><path d="M13.5 12a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 13.5 12Zm3.5-1.5a1.5 1.5 0 1 0 .001 3.001A1.5 1.5 0 0 0 17 10.5Zm-10 0a1.5 1.5 0 1 0 .001 3.001A1.5 1.5 0 0 0 7 10.5Zm17 1.84V19c0 2.757-2.243 5-5 5h-5.917C6.082 24 .47 19.208.03 12.854c-.241-3.476 1.027-6.878 3.479-9.333S9.363-.206 12.836.029C19.096.454 24 5.862 24 12.341Zm-2 0c0-5.431-4.084-9.962-9.299-10.316a10.015 10.015 0 0 0-7.777 2.91 10.019 10.019 0 0 0-2.899 7.782c.373 5.38 5.024 9.285 11.059 9.285h5.917c1.654 0 3-1.346 3-3v-6.66Z"></path></g>
                  </svg>
                </div>
                <div class="icon icon-solid">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g><path d="M12.836.029C9.362-.206 5.961 1.065 3.508 3.521S-.211 9.378.03 12.854C.47 19.208 6.082 24 13.084 24h5.917c2.757 0 5-2.243 5-5v-6.66C24 5.862 19.096.454 12.836.029ZM7 13.5a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 7 13.5Zm5 0a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 12 13.5Zm5 0a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 17 13.5Z"></path></g>
                  </svg>
                </div>
              </div>
              <div class="title-wrapper">
                <span>Broadcast</span>
              </div>
              <div class="active-bar"></div>
            </div>
          </div>
          <div class="nav-btn">
            <div class="wrapper">
              <div class="icon-wrapper">
                <div class="icon icon-regular">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g><path d="M12 12a6 6 0 1 0-6-6 6.006 6.006 0 0 0 6 6Zm0-10a4 4 0 1 1-4 4 4 4 0 0 1 4-4ZM12 14a9.01 9.01 0 0 0-9 9 1 1 0 0 0 2 0 7 7 0 0 1 14 0 1 1 0 0 0 2 0 9.01 9.01 0 0 0-9-9Z"></path></g>
                  </svg>
                </div>
                <div class="icon icon-solid">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <g>
                      <circle cx="256" cy="128" r="128" opacity="1" data-original="#000000"></circle>
                      <path d="M256 298.667c-105.99.118-191.882 86.01-192 192C64 502.449 73.551 512 85.333 512h341.333c11.782 0 21.333-9.551 21.333-21.333-.117-105.99-86.009-191.883-191.999-192z"></path>
                    </g>
                  </svg>
                </div>
              </div>
              <div class="title-wrapper">
                <span>Profile</span>
              </div>
              <div class="active-bar"></div>
            </div>
          </div>
        </nav>
      </footer>
    </div>
    <script type="text/javascript" charset="utf-8">
      const user = JSON.parse(localStorage.getItem("application.user"));
      if (user && user.auth.isLoggedIn) {
        const getUser = async user => {
          const status = { success: false };
          while (!status.success) {
            try {
              const res = await fetch("https://script.google.com/macros/s/AKfycbwEy3EAl_MQqzQ_iYuWdGk1a3AC3Dl-0_clayU3nG7MjiO85yQF_KD9INmJffq-ekxu/exec", {
                method: "POST",
                body: JSON.stringify({
                  query: "CHECKUSER",
                  contents: {
                    query: "CHECK",
                    user: user
                  }
                })
              });
              const data = await res.json();
              status.success = true;
              return data;
            } catch (err) {
              await new Promise(resolve => setTimeout(resolve, 3000));
            }
          }
        };
        getUser(user).then(user => {
          if (!user || !user.session.isValid) {
            //localStorage.removeItem("application.user");
            //window.location.reload();
            return;
          }
        });
      }

      window.ondblclick = () => {
        localStorage.clear();
      };

      window.addEventListener("DOMContentLoaded", () => {
        const fragments = ["home", "search", "broadcast", "profile"];
        const fragment = sessionStorage.getItem("fragment") || "home";
        const index = fragments.indexOf(fragment);
        switch (index) {
          case 0:
            location.replace(`#${fragments[index]}`);
            if (!history.state) {
              history.replaceState({ appStart: true }, "");
            }
            break;
        }
        onCreate(index);
      });

      const navBtn = document.querySelectorAll(".activity-main > footer nav .nav-btn");
      navBtn.forEach((btn, index) => {
        btn.addEventListener("click", () => {
          if (!btn.classList.contains("active")) {
            const fragments = ["home", "search", "broadcast", "profile"];
            if (navBtn[0].classList.contains("active")) {
              history.pushState({ fragment: `${fragments[index]}` }, "", `#${fragments[index]}`);
            } else {
              history.replaceState({ fragment: `${fragments[index]}` }, "", `#${fragments[index]}`);
              switch (index) {
                case 0:
                  onBackPressed();
                  break;
              }
            }
            sessionStorage.setItem("fragment", fragments[index]);
            onCreate(index);
          } else {
            recreate(index);
          }
        });
      });

      window.addEventListener("hashchange", () => {
        const fragments = ["home", "search", "broadcast", "profile"];
        const path = location.hash.replace("#", "");
        const index = fragments.indexOf(path);
        switch (index) {
          case 0:
            onBackPressed();
            break;
        }
        sessionStorage.setItem("fragment", fragments[index]);
        onCreate(index);
      });

      function onBackPressed() {
        const ref = document.referrer;
        const canGoBack = ref === "" || ref.includes(location.hostname);
        if (canGoBack) {
          const goBack = () => {
            if (history.state && history.state.appStart) {
              return;
            } else {
              history.back();
              setTimeout(goBack, 100);
            }
          };
          goBack();
        }
      }

      function onCreate(index) {
        const fragments = document.querySelectorAll(".activity-main > main > .container > .fragment");
        fragments.forEach(fragment => fragment.classList.remove("active"));
        fragments[index].classList.add("active");
        navBtn.forEach(btn => btn.classList.remove("active"));
        navBtn[index].classList.add("active");
        switch (index) {
          case 0:
            renderHome();
            break;
          case 1:
            //renderSearch();
            break;
          case 2:
            //renderBroadcast();
            break;
          case 3:
            //renderProfile();
            break;
        }
      }

      function recreate(index) {
        switch (index) {
          case 0:
            const removeItem = ["home.fragment", "collection.scrollTop", "expanse.scrollTop"];
            removeItem.forEach(item => sessionStorage.removeItem(item));
            break;
          case 1:
            break;
          case 2:
            break;
          case 3:
            break;
        }
        onCreate(index);
      }

      // Fragment Home
      function renderHome() {
        const fragments = ["collection", "expanse"];
        const fragment = sessionStorage.getItem("home.fragment") || "collection";
        const index = fragments.indexOf(fragment);
        loadFragment(index);
      }

      const tabBtn = document.querySelectorAll(".fragment-home > header nav .tab-btn");
      tabBtn.forEach((btn, index) => {
        btn.addEventListener("click", () => {
          if (!btn.classList.contains("active")) {
            const fragments = ["collection", "expanse"];
            sessionStorage.setItem("home.fragment", fragments[index]);
          } else {
            const scrollTop = ["collection.scrollTop", "expanse.scrollTop"];
            sessionStorage.removeItem(scrollTop[index]);
          }
          loadFragment(index);
        });
      });

      function loadFragment(index) {
        const fragmentHome = document.querySelector(".fragment-home");
        fragmentHome.addEventListener("scroll", e => sessionStorage.setItem(["collection.scrollTop", "expanse.scrollTop"][["collection", "expanse"].indexOf(sessionStorage.getItem("home.fragment") || "collection")], e.target.scrollTop));
        const fragments = document.querySelectorAll(".fragment-home > main > .container > .fragment");
        fragments.forEach(fragment => fragment.classList.remove("active"));
        fragments[index].classList.add("active");
        tabBtn.forEach(btn => btn.classList.remove("active"));
        tabBtn[index].classList.add("active");
        fragmentHome.scrollTop = sessionStorage.getItem(["collection.scrollTop", "expanse.scrollTop"][index]) || 0;
        switch (index) {
          case 0:
            break;
          case 1:
            break;
        }
      }
    </script>
  </body>
</html>