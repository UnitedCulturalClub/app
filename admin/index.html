<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="preload" href="/app/assets/fonts/GoogleSans-Regular.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="/app/assets/fonts/Charlotte.ttf" as="font" type="font/ttf" crossorigin />
    <title>Dashboard</title>
    <style>
      :root {
        --text-primary: rgba(0, 0, 0, 1);
        --text-primary-v: rgba(0, 0, 0, 0.7);
        --text-secondary: rgba(0, 0, 0, 0.5);
        --bg: rgba(255, 255, 255, 1);
        --on-bg: rgba(0, 0, 0, 1);
        --devider: rgba(0, 0, 0, 0.1);
      }
      @media only screen and (prefers-color-scheme: dark) {
        :root {
          --text-primary: rgba(255, 255, 255, 1);
          --text-primary-v: rgba(255, 255, 255, 0.7);
          --text-secondary: rgba(190, 190, 190, 1);
          --bg: rgba(42, 45, 54, 1);
          --on-bg: rgba(255, 255, 255, 1);
          --devider: rgba(255, 255, 255, 0.1);
        }
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-Regular.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-Italic.ttf") format("truetype");
        font-weight: 400;
        font-style: italic;
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-Medium.ttf") format("truetype");
        font-weight: 500;
        font-style: normal;
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-MediumItalic.ttf") format("truetype");
        font-weight: 500;
        font-style: italic;
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-Bold.ttf") format("truetype");
        font-weight: 700;
        font-style: normal;
      }
      @font-face {
        font-family: "GoogleSans";
        src: url("/app/assets/fonts/GoogleSans-BoldItalic.ttf") format("truetype");
        font-weight: 700;
        font-style: italic;
      }
      @font-face {
        font-family: "Charlotte";
        src: url("/app/assets/fonts/Charlotte.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: GoogleSans;
        background-color: var(--bg);
      }
      .scrollable.no-scroll {
        overflow-y: hidden;
      }
      .app {
        width: 100%;
      }
      .app > .side {
        width: 80px;
        height: 100%;
        border-right: 1px solid var(--devider);
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        z-index: 100;
      }
      .app > .side .header {
        width: 100%;
      }
      .app > .side .header .nav {
        width: 100%;
        padding: 10px 20px;
        box-sizing: border-box;
        display: flex;
      }
      .app > .side .header .nav .hamburg {
        width: 40px;
        height: 40px;
        padding: 8px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        z-index: 2;
      }
      .app > .side .header .nav .hamburg span {
        width: 100%;
        height: 2px;
        border-radius: 100px;
        background-color: var(--on-bg);
        transition: all 0.1s ease;
      }
      .app > .side .header .nav .hamburg span:nth-child(2) {
        width: 12px;
        margin-top: 5px;
      }
      .app > .side .header .nav .hamburg.active span:nth-child(1) {
        opacity: 0;
        width: 20px;
        transform: rotate(45deg) translate(2.5px, 2.5px);
        animation: fade 0.5s forwards;
      }
      .app > .side .header .nav .hamburg.active span:nth-child(2) {
        opacity: 0;
        width: 20px;
        transform: rotate(-45deg) translate(2.5px, -2.5px);
        animation: fade 0.5s ease forwards;
      }
      .app > .side .header .menu {
        width: 100%;
        height: 100%;
        padding: 60px 28px 0px 28px;
        box-sizing: border-box;
        background-color: var(--bg);
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.1s ease;
        user-select: none;
        z-index: 1;
      }
      .app > .side .header .menu.active {
        pointer-events: auto;
        opacity: 1;
      }
      .app > .side .header .menu-item {
        width: 100%;
        margin: 20px 0;
        color: var(--text-primary);
        font-size: 20px;
        font-weight: 500;
        opacity: 0;
      }
      .app > .side .header .menu-item.active {
        font-size: 40px;
      }
      .app > .side .header .menu.active .menu-item {
        opacity: 0;
        animation: fade 0.5s ease forwards;
      }
      @keyframes fade {
        0% {
          opacity: 0;
        }
        50% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
      .app > .side .nav {
        width: 100%;
        flex: 1;
        padding: 10px;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      .app > .side .nav-item {
        width: 40px;
        height: 40px;
        margin: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .app > .side .nav-icon {
        width: 20px;
        height: 20px;
        color: var(--text-secondary);
        fill: var(--text-secondary);
      }
      .app > .side .nav-item.active .nav-icon {
        color: var(--text-primary);
        fill: var(--text-primary);
      }
      .app > .side .nav-icon .ic {
        width: 100%;
        height: 100%;
      }
      .app > .side .nav-icon .ic-solid {
        display: none;
      }
      .app > .side .btn {
        width: 100%;
        padding: 10px 20px;
        box-sizing: border-box;
      }
      .app > .side .btn-write {
        width: 40px;
        height: 40px;
        border-radius: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #1d9bf0;
      }
      .app > .side .btn-icon {
        width: 20px;
        height: 20px;
        color: #ffffff;
        fill: #ffffff;
      }
      .app > .side .footer .nav-icon {
        width: 32px;
        height: 32px;
        border-radius: 100%;
        background-color: var(--bg);
        overflow: hidden;
      }
      .app > .side .footer .nav-item.active .nav-icon {
        border: 2px solid var(--bg);
        box-sizing: border-box;
        outline: 2px solid var(--on-bg);
      }
      .app > .side .footer .nav-icon img {
        width: 100%;
        height: 100%;
      }
      .app > .main {
        width: 100%;
        padding-left: 80px;
        box-sizing: border-box;
      }
      .app > .main > .fragment {
        display: none;
      }
      .app > .main > .fragment.active {
        display: block;
      }
      .dashboard {
        width: 100%;
      }
      .dashboard > .main {
        width: 100%;
      }
      .dashboard > .main > .fragment {
        width: 100%;
        height: 100vh;
        padding: 8px;
        box-sizing: border-box;
        position: relative;
        display: none;
        flex-direction: column;
        overflow: scroll;
      }
      .dashboard > .main > .fragment.active {
        display: flex;
      }
      .dashboard > .main .fragment .preloader {
        width: 100%;
        height: 100%;
        background-color: var(--color-background);
        position: absolute;
        top: 0;
        left: 0;
        justify-content: center;
        align-items: center;
        pointer-events: none;
        display: none;
        z-index: 1;
      }
      .dashboard > .main .fragment .preloader.active {
        display: flex;
      }
      .dashboard > .main .fragment .preloader .loader {
        width: 30px;
        height: 30px;
      }
      .loader svg {
        animation: progress 1s linear infinite;
      }
      @keyframes progress {
        to {
          transform: rotate(360deg);
        }
      }
      .dashboard > .main .fragment .gen {
        width: 100%;
        display: flex;
        justify-content: start;
        flex-wrap: wrap;
        gap: 28px;
      }
      .gen-card {
        width: 100%;
        max-width: 280px;
        border-radius: 15px;
        background-color: #f7f9fd;
        user-select: none;
      }
      .gen .card-header {
        width: 100%;
        padding: 15px;
        box-sizing: border-box;
        display: flex;
        align-items: stretch;
        gap: 15px;
      }
      .gen-card .header-icon {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        background-color: #ebeaf5;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }
      .gen .card-header .svg {
        width: 20px;
        height: 20px;
        color: #0b284b;
        fill: #0b284b;
      }
      .gen .card-header .img {
        width: 100%;
        height: 100%;
      }
      .gen-card .header-info {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 2px;
      }
      .gen .card-header .tit {
        width: 100%;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .gen .card-header .tit span {
        color: #0b284b;
        font-size: 14px;
        font-weight: 500;
      }
      .gen .card-header .des {
        width: 100%;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .gen .card-header .des span {
        color: #546685;
        font-size: 14px;
      }
      .gen-card .header-option {
        width: 15px;
        display: flex;
        align-items: center;
      }
      .gen .card-header .option {
        color: #0b284b;
        fill: #0b284b;
        width: 100%;
      }
      .gen .card-header .option.disabled {
        color: #546685;
        fill: #546685;
      }
      .gen .card-main {
        width: 100%;
        padding: 0 15px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .gen .card-heading {
        width: 100%;
      }
      .gen .card-heading span {
        color: #0b284b;
        font-size: 16px;
        font-weight: 500;
      }
      .gen .card-overview {
        width: 100%;
        padding: 10px;
        border-left: 2px solid #1d9bf0;
        box-sizing: border-box;
        cursor: pointer;
      }
      .gen .card-overview span {
        color: #546685;
        font-size: 14px;
        font-style:;
      }
      .gen .card-footer {
        width: 100%;
        padding: 15px;
        box-sizing: border-box;
        display: flex;
        justify-content: end;
        gap: 15px;
      }
      .gen .card-tag {
        flex: 1;
        height: 45px;
        border-radius: 10px;
        background-color: #1d9bf0;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .gen .card-tag span {
        color: #ffffff;
        font-size: 16px;
      }
      @media only screen and (prefers-color-scheme: dark) {
        .gen-card {
          background-color: #323640;
        }
        .gen-card .header-icon {
          background-color: #404452;
        }
        .gen .card-header .svg,
        .gen .card-header .tit span,
        .gen .card-heading span,
        .gen .card-header .option {
          color: #ffffff;
          fill: #ffffff;
        }
        .gen .card-header .option.disabled {
          color: rgba(255, 255, 255, 0.5);
          fill: rgba(255, 255, 255, 0.5);
        }
        .gen .card-header .des span,
        .gen .card-overview span {
          color: rgba(255, 255, 255, 0.7);
        }
      }
      .editor {
        width: 100%;
        height: 100%;
        background-color: var(--bg);
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        opacity: 0;
        transition: 0.1s opacity ease-in-out;
        overflow: scroll;
        user-select: none;
        z-index: 101;
      }
      .editor.active {
        pointer-events: auto;
        opacity: 1;
      }
      .editor .heading {
        width: 100%;
        height: 100px;
        max-width: 400px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .editor .heading span {
        color: var(--text-primary);
        font-size: 18px;
        font-family: Charlotte;
      }
      .editor .fields {
        width: 100%;
        max-width: 400px;
        padding: 0 50px;
        box-sizing: border-box;
        margin: 10px auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      .editor .fields label {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .editor .fields label span {
        color: var(--text-primary);
      }
      .editor .fields label input {
        width: 100%;
        height: 45px;
        padding: 10px;
        box-sizing: border-box;
        border-radius: 10px;
        border: 2px solid var(--devider);
        background-color: var(--bg);
        outline: none;
        line-height: 1.5em;
        font-size: 14px;
      }
      .editor .fields label input.invalid {
        text-decoration-line: underline;
        text-decoration-style: wavy;
        text-decoration-color: red;
      }
      .editor .fields label .area {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        border-radius: 10px;
        border: 2px solid var(--devider);
        background-color: var(--bg);
      }
      .editor .fields .area > div {
        width: 100%;
        min-height: 6em;
        max-height: 9em;
        border: none;
        outline: none;
        line-height: 1.5em;
        font-size: 14px;
        white-space: pre-wrap;
        overflow-y: auto;
      }
      .editor .btns {
        width: 100%;
        max-width: 400px;
        padding: 0 50px;
        box-sizing: border-box;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .editor .btn-positive {
        width: 100%;
        height: 45px;
        border-radius: 30px;
        background-color: var(--on-bg);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .editor .btn-positive .loader {
        width: 20px;
        height: 20px;
        display: none;
      }
      .editor .btn-positive.active .loader {
        display: block;
      }
      .editor .btn-positive span {
        color: var(--bg);
      }
      .editor .btn-positive.active span {
        display: none;
      }
      .editor .btn-negetive {
        width: 100%;
        height: 45px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .editor .btn-negetive span {
        color: var(--text-primary-v);
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="side">
        <div class="header">
          <nav class="nav">
            <div class="hamburg">
              <span></span>
              <span></span>
            </div>
          </nav>
          <div class="menu">
            <div class="menu-item">
              <span>Collections</span>
            </div>
            <div class="menu-item">
              <span>Expanses</span>
            </div>
          </div>
        </div>
        <div class="nav">
          <div class="nav-item">
            <div class="nav-icon">
              <div class="ic ic-regular">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <g><path d="M7 0H4a4 4 0 0 0-4 4v3a4 4 0 0 0 4 4h3a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4Zm2 7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2ZM20 0h-3a4 4 0 0 0-4 4v3a4 4 0 0 0 4 4h3a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4Zm2 7a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2ZM7 13H4a4 4 0 0 0-4 4v3a4 4 0 0 0 4 4h3a4 4 0 0 0 4-4v-3a4 4 0 0 0-4-4Zm2 7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2ZM20 13h-3a4 4 0 0 0-4 4v3a4 4 0 0 0 4 4h3a4 4 0 0 0 4-4v-3a4 4 0 0 0-4-4Zm2 7a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2Z"></path></g>
                </svg>
              </div>
              <div class="ic ic-solid">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <g><path d="M85.333 0h64c47.128 0 85.333 38.205 85.333 85.333v64c0 47.128-38.205 85.333-85.333 85.333h-64C38.205 234.667 0 196.462 0 149.333v-64C0 38.205 38.205 0 85.333 0zM362.667 0h64C473.795 0 512 38.205 512 85.333v64c0 47.128-38.205 85.333-85.333 85.333h-64c-47.128 0-85.333-38.205-85.333-85.333v-64C277.333 38.205 315.538 0 362.667 0zM85.333 277.333h64c47.128 0 85.333 38.205 85.333 85.333v64c0 47.128-38.205 85.333-85.333 85.333h-64C38.205 512 0 473.795 0 426.667v-64c0-47.129 38.205-85.334 85.333-85.334zM362.667 277.333h64c47.128 0 85.333 38.205 85.333 85.333v64C512 473.795 473.795 512 426.667 512h-64c-47.128 0-85.333-38.205-85.333-85.333v-64c-.001-47.129 38.204-85.334 85.333-85.334z"></path></g>
                </svg>
              </div>
            </div>
          </div>
        </div>
        <div class="btn">
          <div class="btn-write">
            <div class="btn-icon">
              <svg viewBox="0 0 24 24">
                <g><path d="M23 3c-6.62-.1-10.38 2.421-13.05 6.03C7.29 12.61 6 17.331 6 22h2c0-1.007.07-2.012.19-3H12c4.1 0 7.48-3.082 7.94-7.054C22.79 10.147 23.17 6.359 23 3zm-7 8h-1.5v2H16c.63-.016 1.2-.08 1.72-.188C16.95 15.24 14.68 17 12 17H8.55c.57-2.512 1.57-4.851 3-6.78 2.16-2.912 5.29-4.911 9.45-5.187C20.95 8.079 19.9 11 16 11zM4 9V6H1V4h3V1h2v3h3v2H6v3H4z"></path></g>
              </svg>
            </div>
          </div>
        </div>
        <div class="footer">
          <div class="nav">
            <div class="nav-item">
              <div class="nav-icon">
                <div class="ic">
                  <img src="" alt="" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="main">
        <div class="fragment dashboard">
          <div class="main">
            <div class="fragment coll">
              <div class="preloader">
                <div class="loader">
                  <svg height="100%" viewBox="0 0 32 32" width="100%">
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: rgb(29, 155, 240); opacity: 0.1"></circle>
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: rgb(29, 155, 240); stroke-dasharray: 80; stroke-dashoffset: 60"></circle>
                  </svg>
                </div>
              </div>
              <div class="gen"></div>
            </div>
            <div class="fragment exp">
              <div class="preloader">
                <div class="loader">
                  <svg height="100%" viewBox="0 0 32 32" width="100%">
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: rgb(29, 155, 240); opacity: 0.1"></circle>
                    <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: rgb(29, 155, 240); stroke-dasharray: 80; stroke-dashoffset: 60"></circle>
                  </svg>
                </div>
              </div>
              <div class="gen"></div>
            </div>
          </div>
        </div>
        <div class="fragment"></div>
      </div>
      <div class="activity">
        <div class="editor">
          <div class="heading">
            <span></span>
          </div>
          <div class="fields">
            <label for="id">
              <span></span>
              <input type="text" id="id" pattern="\d{8}" maxlength="8" inputmode="numeric" />
            </label>
            <label for="title">
              <span></span>
              <input type="text" id="title" />
            </label>
            <label for="tag">
              <span></span>
              <input type="text" id="tag" pattern="\d{8}" maxlength="8" inputmode="numeric" />
            </label>
            <label for="overview">
              <span></span>
              <div class="area">
                <div id="overview" contenteditable="true"></div>
              </div>
            </label>
          </div>
          <div class="btns">
            <div class="btn-positive">
              <span></span>
              <div class="loader">
                <svg height="100%" viewBox="0 0 32 32" width="100%">
                  <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: var(--bg); opacity: 0.1"></circle>
                  <circle cx="16" cy="16" fill="none" r="14" stroke-width="4" style="stroke: var(--bg); stroke-dasharray: 80; stroke-dashoffset: 60"></circle>
                </svg>
              </div>
            </div>
            <div class="btn-negetive">
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", e => {
        const hash = new URL(window.location.href).hash.replace(/^#\/?/, "");
        const parts = hash.split("/").filter(Boolean);
        if (["dashboard", "profile"].includes(parts[0] || "dashboard")) {
          const index = ["dashboard", "profile"].indexOf(parts[0] || "dashboard");
          onCreate(index);
        }
      });

      const navItem = document.querySelectorAll(".app > .side .nav-item");
      navItem.forEach((item, index) => {
        item.addEventListener("click", e => {
          if (!item.classList.contains("active")) {
            const fragments = ["dashboard", "profile"];
            if (navItem[0].classList.contains("active")) {
              history.pushState({}, "", `#/${fragments[index]}`);
            } else {
              switch (index) {
                case 0:
                  onBackPressed();
                  break;
              }
              history.replaceState({}, "", `#/${fragments[index]}`);
            }
            onCreate(index);
          } else {
          }
        });
      });

      window.addEventListener("hashchange", e => {
        const hash = new URL(e.newURL).hash.replace(/^#\/?/, "");
        const parts = hash.split("/").filter(Boolean);
        const isValid = parts => {
          const paths = {
            dashboard: { menu: {}, coll: {}, exp: {} },
            profile: {}
          };
          let current = paths;
          for (const part of parts) {
            if (!(part in current)) return false;
            current = current[part];
          }
          return true;
        };
        if (!isValid(parts)) {
          if (history.length > 1) history.back();
          else window.location.hash = "#/dashboard/coll";
          return;
        }
        if (["dashboard", "profile"].includes(parts[0])) {
          const index = ["dashboard", "profile"].indexOf(parts[0]);
          onCreate(index);
          return;
        }
      });

      function onBackPressed() {
        const ref = document.referrer;
        const canGoBack = ref === "" || ref.includes(location.hostname);
        if (canGoBack) {
          const goBack = () => {
            const hashPath = location.hash.replace(/^#\/?/, "");
            if (hashPath.startsWith("dashboard/") && ["coll", "exp"].includes(hashPath.split("/")[1])) {
              return;
            } else {
              history.back();
              setTimeout(goBack, 100);
            }
          };
          goBack();
        }
      }

      function onCreate(index) {
        const fragments = document.querySelectorAll(".app > .main > .fragment");
        fragments.forEach(fragment => fragment.classList.remove("active"));
        fragments[index].classList.add("active");
        navItem.forEach(item => item.classList.remove("active"));
        navItem[index].classList.add("active");
        switch (index) {
          case 0:
            renderDashboard();
            break;
          case 1:
            //renderProfile();
            break;
        }
      }

      function renderDashboard() {
        const hash = new URL(window.location.href).hash.replace(/^#\/?/, "");
        const parts = hash.split("/").filter(Boolean);
        if (["menu"].includes(parts[1])) {
          hamburg.classList.add("active");
          menu.classList.add("active");
          document.body.classList.add("scrollable");
          document.querySelectorAll(".scrollable").forEach(item => {
            item.classList.add("no-scroll");
          });
        } else if (["coll", "exp"].includes(parts[1] || "coll")) {
          const index = ["coll", "exp"].indexOf(parts[1] || "coll");
          switch (index) {
            case 0:
              if (!history.state) history.replaceState({}, "", "#/dashboard/coll");
              break;
          }
          sessionStorage.setItem("app[0][1][fragment][admin]", ["coll", "exp"][index]);
          if (["overview"].includes(parts[2])) if (history.state.sheet?.isShow) history.back();
        }
        const fragment = sessionStorage.getItem("app[0][1][fragment][admin]") || "coll";
        const index = ["coll", "exp"].indexOf(fragment);
        loadFragment(index);
      }

      const menu = document.querySelector(".app > .side .header .menu");
      const hamburg = document.querySelector(".app > .side .header .nav .hamburg");
      hamburg.addEventListener("click", e => {
        if (!menu.classList.contains("active")) {
          history.pushState({}, "", "#/dashboard/menu");
          hamburg.classList.add("active");
          menu.classList.add("active");
          document.body.classList.add("scrollable");
          document.querySelectorAll(".scrollable").forEach(item => {
            item.classList.add("no-scroll");
          });
        } else {
          history.back();
        }
      });

      window.addEventListener("hashchange", e => {
        const hash = new URL(e.oldURL).hash.replace(/^#\/?/, "");
        const parts = hash.split("/").filter(Boolean);
        if (["dashboard"].includes(parts[0])) {
          const index = ["dashboard"].indexOf(parts[0]);
          switch (index) {
            case 0:
              if (["menu"].includes(parts[1])) {
                hamburg.classList.remove("active");
                menu.classList.remove("active");
                document.querySelectorAll(".scrollable").forEach(item => {
                  item.classList.remove("no-scroll");
                });
              }
              break;
          }
        }
      });

      const menuItem = document.querySelectorAll(".app > .side .header .menu-item");
      menuItem.forEach((item, index) => {
        item.addEventListener("click", e => {
          if (!item.classList.contains("active")) {
            const fragments = ["coll", "exp"];
            if (menuItem[0].classList.contains("active")) {
              history.replaceState({}, "", "#/dashboard/exp");
              hamburg.classList.remove("active");
              menu.classList.remove("active");
              document.querySelectorAll(".scrollable").forEach(item => {
                item.classList.remove("no-scroll");
              });
            } else {
              history.go(-2);
            }
            sessionStorage.setItem("app[0][1][fragment][admin]", fragments[index]);
            loadFragment(index);
          } else {
            history.back();
          }
        });
      });

      const fetchData = () => {
        fetchColl();
        async function fetchColl() {
          sessionStorage.removeItem("application.data.coll");
          const preloader = document.querySelector(".dashboard > .main .coll .preloader");
          try {
            preloader.classList.add("active");
            const res = await fetch("https://script.google.com/macros/s/AKfycbzzvCPKVCipQmze4YTP6DcjFCq5yBwYHqyqZHtp0a-iarlF1mZ8ND_TD4orbHy1r2kqOQ/exec");
            if (!res.ok) throw new Error();
            const data = await res.json();
            if (!data.data[0]?.length) {
              preloader.classList.remove("active");
              localStorage.removeItem("application.data.coll");
              //
              return;
            }
            preloader.classList.remove("active");
            localStorage.setItem("application.data.coll", JSON.stringify(data.data[0]));
            sessionStorage.setItem("application.data.coll", JSON.stringify(data.data[0]));
            renderColl();
          } catch {}
        }

        fetchExp();
        async function fetchExp() {
          sessionStorage.removeItem("application.data.exp");
          const preloader = document.querySelector(".dashboard > .main .exp .preloader");
          try {
            preloader.classList.add("active");
            const res = await fetch("https://script.google.com/macros/s/AKfycbzzvCPKVCipQmze4YTP6DcjFCq5yBwYHqyqZHtp0a-iarlF1mZ8ND_TD4orbHy1r2kqOQ/exec");
            if (!res.ok) throw new Error();
            const data = await res.json();
            if (!data.data[1]?.length) {
              preloader.classList.remove("active");
              sessionStorage.removeItem("application.data.exp");
              //
              return;
            }
            preloader.classList.remove("active");
            localStorage.setItem("application.data.exp", JSON.stringify(data.data[1]));
            sessionStorage.setItem("application.data.exp", JSON.stringify(data.data[1]));
            renderExp();
          } catch {}
        }
      };
      fetchData();

      function loadFragment(index) {
        const fragments = document.querySelectorAll(".dashboard > .main > .fragment");
        fragments.forEach(fragment => fragment.classList.remove("active"));
        fragments[index].classList.add("active");
        menuItem.forEach(item => item.classList.remove("active"));
        menuItem[index].classList.add("active");
        switch (index) {
          case 0:
            renderColl();
            break;
          case 1:
            //renderExp();
            break;
        }
      }

      function renderColl() {
        const data = (() => {
          try {
            return JSON.parse(sessionStorage.getItem("application.data.coll")) || [];
          } catch (err) {
            return [];
          }
        })();
        if (!data?.length) return;
        const root = document.querySelector(".dashboard > .main .coll .gen");
        genCard(data, root, true);
      }

      function renderExp() {
        const data = (() => {
          try {
            return JSON.parse(sessionStorage.getItem("application.data.exp")) || [];
          } catch (err) {
            return [];
          }
        })();
        if (!data?.length) return;
        const root = document.querySelector(".dashboard > .main .exp .gen");
        genCard(data, root, true);
      }

      function genCard(data, root, flag) {
        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        const daysEn = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const daysBn = ["রবিবার", "সোমবার", "মঙ্গলবার", "বুধবার", "বৃহস্পতিবার", "শুক্রবার", "শনিবার"];
        const parseId = id => {
          if (!/^\d{8}$/.test(id)) return { isValid: false, toDate: () => null };
          const date = new Date(parseInt(String(id).slice(4), 10), parseInt(String(id).slice(2, 4), 10) - 1, parseInt(String(id).slice(0, 2), 10));
          const isValid = date.getFullYear() === parseInt(String(id).slice(4), 10) && date.getMonth() === parseInt(String(id).slice(2, 4), 10) - 1 && date.getDate() === parseInt(String(id).slice(0, 2), 10);
          return { isValid, toDate: () => (isValid ? date : null) };
        };
        const timeAgo = d => {
          const s = Math.floor((new Date() - d) / 1000);
          const intervals = [
            ["y", 31536000],
            ["mo", 2592000],
            ["w", 604800],
            ["d", 86400],
            ["h", 3600],
            ["m", 60],
            ["s", 1]
          ];
          for (const [label, sec] of intervals) if (s >= sec) return Math.floor(s / sec) + label + " ago";
          return "now";
        };
        const truncate = (text, max) => (text && text.length > max ? text.slice(0, max).trim() + "..." : text || "");
        const inrFormatter = new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR", maximumFractionDigits: 0 });
        const toInr = num => inrFormatter.format(num);
        root.querySelectorAll(".gen-card").forEach(card => {
          card.remove();
        });
        data.forEach(data => {
          let myId = data.id;
          console.log(myId)
          if (String(myId).length < 8){
            myId = `0${myId}`;
          }
          const date = parseId(myId).toDate();
          const timestamp = new Date(data.timestamp);
          const now = new Date();
          const card = document.createElement("div");
          card.classList.add("gen-card");
          const cardHeader = document.createElement("div");
          cardHeader.classList.add("card-header");
          const headerIcon = document.createElement("div");
          headerIcon.classList.add("header-icon");
          const svg = document.createElement("div");
          svg.classList.add("svg");
          svg.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M8 12H6c-1.103 0-2 .897-2 2v2c0 1.103.897 2 2 2h2c1.103 0 2-.897 2-2v-2c0-1.103-.897-2-2-2Zm-2 4v-2h2v2H6ZM19 2h-1V1a1 1 0 1 0-2 0v1H8V1a1 1 0 1 0-2 0v1H5C2.243 2 0 4.243 0 7v12c0 2.757 2.243 5 5 5h14c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5ZM5 4h14c1.654 0 3 1.346 3 3v1H2V7c0-1.654 1.346-3 3-3Zm14 18H5c-1.654 0-3-1.346-3-3v-9h20v9c0 1.654-1.346 3-3 3Z"></path></g></svg>`;
          headerIcon.appendChild(svg);
          cardHeader.appendChild(headerIcon);
          const headerInfo = document.createElement("div");
          headerInfo.classList.add("header-info");
          const tit = document.createElement("div");
          tit.classList.add("tit");
          tit.innerHTML = `<span>${daysEn[date.getDay()]} (${daysBn[date.getDay()]})</span>`;
          headerInfo.appendChild(tit);
          const des = document.createElement("div");
          des.classList.add("des");
          des.innerHTML = `<span>${date.getDate()} ${months[date.getMonth()]}, ${date.getFullYear()} - ${timeAgo(new Date(data.timestamp))}</span>`;
          headerInfo.appendChild(des);
          cardHeader.appendChild(headerInfo);
          //
          const headerOption = document.createElement("div");
          headerOption.classList.add("header-option");
          const option = document.createElement("div");
          option.classList.add("option");
          if (now - timestamp <= 86400000) {
            option.addEventListener("click", e => {
              const fragment = sessionStorage.getItem("app[0][1][fragment][admin]") || "coll";
              const index = ["coll", "exp"].indexOf(fragment);
              const query = "edit";
              openEditor(index, query, data);
            });
          } else {
            option.classList.add("disabled");
          }
          const optionIcon = document.createElement("div");
          optionIcon.classList.add("option-icon");
          optionIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><circle cx="256" cy="53.333" r="53.333"></circle><circle cx="256" cy="256" r="53.333"></circle><circle cx="256" cy="458.667" r="53.333"></circle></g></svg>`;
          //optionIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M22.853 1.148a3.626 3.626 0 0 0-5.124 0L1.465 17.412A4.968 4.968 0 0 0 0 20.947V23a1 1 0 0 0 1 1h2.053a4.966 4.966 0 0 0 3.535-1.464L22.853 6.271a3.626 3.626 0 0 0 0-5.123ZM5.174 21.122A3.022 3.022 0 0 1 3.053 22H2v-1.053a2.98 2.98 0 0 1 .879-2.121L15.222 6.483l2.3 2.3ZM21.438 4.857l-2.506 2.507-2.3-2.295 2.507-2.507a1.623 1.623 0 1 1 2.295 2.3Z"></path></g></svg>`;
          option.appendChild(optionIcon);
          headerOption.appendChild(option);
          cardHeader.appendChild(headerOption);
          //
          card.appendChild(cardHeader);
          const cardMain = document.createElement("div");
          cardMain.classList.add("card-main");
          const cardHeading = document.createElement("div");
          cardHeading.classList.add("card-heading");
          cardHeading.innerHTML = `<span>Overview</span>`;
          cardMain.appendChild(cardHeading);
          const cardOverview = document.createElement("div");
          cardOverview.classList.add("card-overview");
          cardOverview.innerHTML = `<span>${data.overview}</span>`;
          cardOverview.addEventListener("click", () => {});
          cardMain.appendChild(cardOverview);
          card.appendChild(cardMain);
          const cardFooter = document.createElement("div");
          cardFooter.classList.add("card-footer");
          const cardTag = document.createElement("div");
          cardTag.classList.add("card-tag");
          cardTag.innerHTML = `<span>${toInr(data.tag)}</span>`;
          cardFooter.appendChild(cardTag);
          card.appendChild(cardFooter);
          if (flag) {
            if (root.firstElementChild) {
              root.insertBefore(card, root.firstChild);
            } else root.appendChild(card);
          } else root.appendChild(card);
        });
      }

      document.querySelector(".app > .side .btn-write").addEventListener("click", e => {
        const fragment = sessionStorage.getItem("app[0][1][fragment][admin]") || "coll";
        const index = ["coll", "exp"].indexOf(fragment);
        openEditor(index);
      });

      function openEditor(i, q, d) {
        const subO = ["coll", "exp"][i];
        const subT = ["add", "edit"][["", "edit"].indexOf(q)] ?? "add";
        history.pushState({}, "", `#/dashboard/${subO}/${subT}`);
        const editor = document.querySelector(".app > .activity .editor");
        document.body.classList.add("scrollable");
        document.querySelectorAll(".scrollable").forEach(item => {
          item.classList.add("no-scroll");
        });
        editor.classList.add("active");
        editor.setAttribute("data-query", ["WRITE", "EDIT"][["", "edit"].indexOf(q)] ?? "WRITE");
        editor.setAttribute("data-type", ["COLL", "EXP"][i]);
        editor.querySelector(".heading span").textContent = ["Collection", "Expanse"][i];
        editor.querySelector(".fields label[for='id'] span").textContent = ["Collection Id", "Expanse Id"][i];
        editor.querySelector(".fields label[for='title'] span").textContent = "Title (Optional)";
        editor.querySelector(".fields label[for='tag'] span").textContent = ["Collection Tag", "Expanse Tag"][i];
        editor.querySelector(".fields label[for='overview'] span").textContent = "Overview";
        editor.querySelector(".btns .btn-positive span").textContent = q ? "Update" : "Add";
        editor.querySelector(".btns .btn-negetive span").textContent = "Cancel";
        const idIn = editor.querySelector(".fields #id");
        idIn.disabled = [false, true][["", "edit"].indexOf(q)] ?? false;
        idIn.value = d?.id || "";
        idIn.addEventListener("input", e => {
          if (idIn.classList.contains("invalid")) idIn.classList.remove("invalid");
          idIn.value = idIn.value.replace(/\D/g, "");
          if (idIn.value.length > 8) {
            idIn.value = idIn.value.slice(0, 8);
          }
        });
        const titleIn = editor.querySelector(".fields #title");
        titleIn.value = d?.title || "";
        const tagIn = editor.querySelector(".fields #tag");
        tagIn.value = d?.tag || "";
        tagIn.addEventListener("input", e => {});
        const overviewIn = editor.querySelector(".fields #overview");
        overviewIn.textContent = d?.overview || "";
        const btnPositive = editor.querySelector(".btns .btn-positive");
        const onPositive = () => {
          if (!idIn.value || idIn.value.length < 8) {
            idIn.focus();
            return;
          } else if (!parseId(idIn.value).isValid) {
            idIn.classList.add("invalid");
            idIn.focus();
            return;
          } else if (!tagIn.value) {
            tagIn.focus();
            return;
          } else if (!overviewIn.textContent) {
            overviewIn.focus();
            return;
          }
          function parseId(id) {
            if (!/^\d{8}$/.test(id)) return { isValid: false, toDate: () => null };
            const date = new Date(parseInt(String(id).slice(4), 10), parseInt(String(id).slice(2, 4), 10) - 1, parseInt(String(id).slice(0, 2), 10));
            const isValid = date.getFullYear() === parseInt(String(id).slice(4), 10) && date.getMonth() === parseInt(String(id).slice(2, 4), 10) - 1 && date.getDate() === parseInt(String(id).slice(0, 2), 10);
            return { isValid, toDate: () => (isValid ? date : null) };
          }
          const user = (() => {
            try {
              return JSON.parse(localStorage.getItem("application.user")) || {};
            } catch {
              return {};
            }
          })();
          const meta = (() => {
            if (!user.auth?.isLoggedIn) return {};
            return {
              author: {
                account: user.account || "",
                device: user.device || "",
                profile: user.profile || ""
              },
              timestamp: new Date()
            };
          })();
          const url = "https://script.google.com/macros/s/AKfycbzzvCPKVCipQmze4YTP6DcjFCq5yBwYHqyqZHtp0a-iarlF1mZ8ND_TD4orbHy1r2kqOQ/exec";
          const query = editor.dataset.query;
          const data = {
            id: idIn.value.trim(),
            title: titleIn.value?.trim() || "",
            tag: tagIn.value.trim(),
            overview: overviewIn.textContent.trim(),
            meta: meta
          };
          const type = editor.dataset.type;
          btnPositive.removeEventListener("click", onPositive);
          btnPositive.classList.add("active");
          fetch(url, { method: "POST", body: JSON.stringify({ query: "WRITEDATA", contents: { query, data, type } }) })
            .then(res => res.json())
            .then(res => {
              btnPositive.classList.remove("active");
              btnPositive.addEventListener("click", onPositive);
              if (!res.status.isSuccess) {
                if ((query.includes("WRITE") && res.data?.isExist) || (query.includes("EDIT") && !res.data?.isExist)) {
                  idIn.classList.add("invalid");
                  idIn.focus();
                  return;
                }
              }
              idIn.value = "";
              titleIn.value = "";
              tagIn.value = "";
              overviewIn.textContent = "";
              fetchData();
            })
            .catch(err => {
              btnPositive.classList.remove("active");
              btnPositive.addEventListener(onPositive);
            });
        };
        btnPositive.addEventListener("click", onPositive);
        const btnNegetive = editor.querySelector(".btns .btn-negetive");
        const onNegetive = () => history.back();
        btnNegetive.addEventListener("click", onNegetive);
        const onHash = e => {
          const hash = new URL(e.oldURL).hash.replace(/^#\/?/, "");
          const parts = hash.split("/").filter(Boolean);
          if (["dashboard"].includes(parts[0])) {
            if (["add", "edit"].includes(parts[2])) {
              document.querySelectorAll(".scrollable").forEach(item => {
                item.classList.remove("no-scroll");
              });
              editor.classList.remove("active");
              btnPositive.removeEventListener("click", onPositive);
              btnNegetive.removeEventListener("click", onNegetive);
            }
          }
          window.removeEventListener("hashchange", onHash);
        };
        window.addEventListener("hashchange", onHash);
      }
      const onLoad = () => {
        const hash = new URL(window.location.href).hash.replace(/^#\/?/, "");
        const parts = hash.split("/").filter(Boolean);
        if (["dashboard"].includes(parts[0])) if (["add", "edit"].includes(parts[2])) history.back();
        window.removeEventListener("DOMContentLoaded", onLoad);
      };
      window.addEventListener("DOMContentLoaded", onLoad);
    </script>
  </body>
</html>
